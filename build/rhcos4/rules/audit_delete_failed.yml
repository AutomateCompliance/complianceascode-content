conflicts: []
definition_location: /home/chase/_work/complianceascode-content/complianceascode-content/linux_os/guide/system/auditing/policy_rules/audit_delete_failed/rule.yml
description: 'Ensure that unsuccessful attempts to delete a file are audited.


  The following rules configure audit as described above:

  <pre>## Unsuccessful file delete

  -a always,exit -F arch=b32 -S unlink,unlinkat,rename,renameat -F exit=-EACCES -F
  auid&gt;=1000 -F auid!=unset -F key=unsuccessful-delete

  -a always,exit -F arch=b64 -S unlink,unlinkat,rename,renameat -F exit=-EACCES -F
  auid&gt;=1000 -F auid!=unset -F key=unsuccessful-delete

  -a always,exit -F arch=b32 -S unlink,unlinkat,rename,renameat -F exit=-EPERM -F
  auid&gt;=1000 -F auid!=unset -F key=unsuccessful-delete

  -a always,exit -F arch=b64 -S unlink,unlinkat,rename,renameat -F exit=-EPERM -F
  auid&gt;=1000 -F auid!=unset -F key=unsuccessful-delete

  </pre>


  The <tt>Audit</tt> package provides pre-configured  rules in <tt>/usr/share/audit/sample-rules</tt>.
  The above content can be found in <tt>/usr/share/audit/sample-rules/30-ospp-v42-4-delete-failed.rules</tt>.

  To deploy this configuration, it is recommended to copy it over to the <tt>/etc/audit/rules.d/</tt>
  directory:

  <pre>

  cp /usr/share/audit/sample-rules/30-ospp-v42-4-delete-failed.rules /etc/audit/rules.d/

  </pre>


  Load new Audit rules into kernel by running:

  <pre>augenrules --load</pre>


  Note: This rule utilizes a file provided by <tt>Audit</tt> package to comply with
  OSPP 4.2.1. You may reuse this rule in different profiles. If you decide to do so,
  it is recommended that you inspect contents of the file closely and make sure that
  they are alligned with your needs.'
identifiers: {}
inherited_platforms:
- machine
ocil: 'To verify that the <tt>Audit</tt> is correctly configured according to recommended
  rules, check the content of the file with the following command:

  <pre>cat /etc/audit/rules.d/30-ospp-v42-4-delete-failed.rules</pre>

  The output has to be exactly as follows:

  <pre>## Unsuccessful file delete

  -a always,exit -F arch=b32 -S unlink,unlinkat,rename,renameat -F exit=-EACCES -F
  auid&gt;=1000 -F auid!=unset -F key=unsuccessful-delete

  -a always,exit -F arch=b64 -S unlink,unlinkat,rename,renameat -F exit=-EACCES -F
  auid&gt;=1000 -F auid!=unset -F key=unsuccessful-delete

  -a always,exit -F arch=b32 -S unlink,unlinkat,rename,renameat -F exit=-EPERM -F
  auid&gt;=1000 -F auid!=unset -F key=unsuccessful-delete

  -a always,exit -F arch=b64 -S unlink,unlinkat,rename,renameat -F exit=-EPERM -F
  auid&gt;=1000 -F auid!=unset -F key=unsuccessful-delete

  </pre>'
ocil_clause: the file does not exist or the content differs
oval_external_content: null
platform: null
platforms: !!set
  machine: null
prodtype: ol8,rhcos4,rhel8,rhel9
rationale: 'Unsuccessful attempts to delete a file might be signs of malicious activities.
  Auditing of such events help in monitoring and investigating of such activities. '
references:
  nist: AU-2(a)
  ospp: FAU_GEN.1.1.c
  srg: SRG-OS-000458-GPOS-00203,SRG-OS-000474-GPOS-00219,SRG-OS-000475-GPOS-00220,SRG-OS-000463-GPOS-00207,SRG-OS-000465-GPOS-00209,SRG-OS-000461-GPOS-00205,SRG-OS-000468-GPOS-00212,SRG-OS-000467-GPOS-00211
requires: []
severity: medium
template:
  backends: {}
  name: audit_file_contents
  vars:
    contents: '## Unsuccessful file delete

      -a always,exit -F arch=b32 -S unlink,unlinkat,rename,renameat -F exit=-EACCES
      -F auid&gt;=1000 -F auid!=unset -F key=unsuccessful-delete

      -a always,exit -F arch=b64 -S unlink,unlinkat,rename,renameat -F exit=-EACCES
      -F auid&gt;=1000 -F auid!=unset -F key=unsuccessful-delete

      -a always,exit -F arch=b32 -S unlink,unlinkat,rename,renameat -F exit=-EPERM
      -F auid&gt;=1000 -F auid!=unset -F key=unsuccessful-delete

      -a always,exit -F arch=b64 -S unlink,unlinkat,rename,renameat -F exit=-EPERM
      -F auid&gt;=1000 -F auid!=unset -F key=unsuccessful-delete

      '
    filepath: /etc/audit/rules.d/30-ospp-v42-4-delete-failed.rules
title: Configure auditing of unsuccessful file deletions
warnings: []
