# platform = multi_platform_sle,Red Hat Enterprise Linux 8,multi_platform_fedora
# reboot = false
# strategy = restrict
# complexity = medium
# disruption = medium
- name: Read list libraries without root ownership
  find:
    paths:
      - /usr/lib
      - /usr/lib64
      - /lib
      - /lib64
    file_type: directory
  register: library_dirs_not_group_owned_by_root
  tags:
    - CCE-85894-4
    - DISA-STIG-RHEL-08-010350
    - NIST-800-53-CM-5(6)
    - NIST-800-53-CM-5(6).1
    - dir_group_ownership_library_dirs
    - medium_complexity
    - medium_disruption
    - medium_severity
    - no_reboot_needed
    - restrict_strategy

- name: Set group ownership of system library dirs to root
  file:
    path: '{{ item.path }}'
    group: root
    state: directory
    mode: '{{ item.mode }}'
  with_items: '{{ library_dirs_not_group_owned_by_root.files }}'
  when:
    - library_dirs_not_group_owned_by_root.matched > 0
    - item.gid != 0
  tags:
    - CCE-85894-4
    - DISA-STIG-RHEL-08-010350
    - NIST-800-53-CM-5(6)
    - NIST-800-53-CM-5(6).1
    - dir_group_ownership_library_dirs
    - medium_complexity
    - medium_disruption
    - medium_severity
    - no_reboot_needed
    - restrict_strategy
